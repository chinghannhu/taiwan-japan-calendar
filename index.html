<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="台灣日本月曆生成器 - 支援多語言的線上月曆工具，包含節日顯示、日本年號及台灣民國紀年，現增加農曆月曆功能。">
    <meta name="keywords" content="月曆,日曆,台灣節日,日本節日,線上工具,calendar,民國紀年,日本年號,農曆,24節氣">
    <meta name="author" content="Taiwan Japan Calendar Generator">
    <title>台灣日本月曆+農曆生成器</title>
    
    <!-- Google Fonts - Multi-language Typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@100..800&family=Noto+Sans+TC:wght@300;400;500;600;700&family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- SheetJS for Excel export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- SVG favicon (現代瀏覽器) -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <!-- PNG favicon (後備選項) -->
    <link rel="icon" type="image/png" href="favicon.png">
    <!-- ICO favicon (舊版瀏覽器) -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Sora", "Noto Sans TC", "Noto Sans JP", sans-serif;
            font-optical-sizing: auto;
            font-weight: 400;
            font-style: normal;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
            color: #333333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #333333;
            padding: 30px;
            text-align: center;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-family: "Sora", "Noto Sans TC", "Noto Sans JP", sans-serif;
            font-weight: 700;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: none;
            color: #333333;
        }
        .header h1 a {
            color: inherit;
            text-decoration: none;
            transition: opacity 0.3s ease;
        }

        .header h1 a:hover {
            opacity: 0.8;
        }

        .subtitle {
            font-family: "Sora", "Noto Sans TC", "Noto Sans JP", sans-serif;
            font-weight: 400;
            opacity: 0.7;
            font-size: 1.1em;
            color: #666666;
        }

        .controls {
            padding: 30px;
            background: linear-gradient(135deg, #fafafa 0%, #f0f0f0 100%);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .control-group {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            align-items: end;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-family: "Sora", "Noto Sans TC", "Noto Sans JP", sans-serif;
            font-weight: 600;
            color: #333333;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .form-group select,
        .form-group input {
            font-family: "Sora", "Noto Sans TC", "Noto Sans JP", sans-serif;
            font-weight: 400;
            padding: 12px 20px;
            border: 2px solid rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
            color: #333333;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            position: relative;
        }

        .form-group select {
            background-image: url('data:image/svg+xml;utf8,<svg fill="%23333333" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 20px;
            padding-right: 45px;
            cursor: pointer;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #666666;
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
            background-color: #fafafa;
        }

        .form-group select:hover {
            border-color: #666666;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .button-group {
            display: flex;
            justify-content: center;
        }

        .btn {
            font-family: "Sora", "Noto Sans TC", "Noto Sans JP", sans-serif;
            font-weight: 600;
            padding: 15px 35px;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            margin-top: 24px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, #1a1a1a 0%, #000000 100%);
        }

        .btn-export {
            font-family: "Sora", "Noto Sans TC", "Noto Sans JP", sans-serif;
            font-weight: 600;
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            color: white;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.15);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-excel {
            background: linear-gradient(135deg, #217346 0%, #1a5f37 100%);
        }

        .btn-excel:hover {
            background: linear-gradient(135deg, #1a5f37 0%, #0f4d2a 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(33, 115, 70, 0.4);
        }

        .btn-word {
            background: linear-gradient(135deg, #2b579a 0%, #1d4084 100%);
        }

        .btn-word:hover {
            background: linear-gradient(135deg, #1d4084 0%, #163366 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(43, 87, 154, 0.4);
        }

        .btn-pdf {
            background: linear-gradient(135deg, #d83b01 0%, #c4350a 100%);
        }

        .btn-pdf:hover {
            background: linear-gradient(135deg, #c4350a 0%, #a42d08 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(216, 59, 1, 0.4);
        }

        .btn-print {
            background: linear-gradient(135deg, #5a5a5a 0%, #404040 100%);
        }

        .btn-print:hover {
            background: linear-gradient(135deg, #404040 0%, #2a2a2a 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(90, 90, 90, 0.4);
        }

        .btn-email {
            background: linear-gradient(135deg, #0078d4 0%, #005a9e 100%);
        }

        .btn-email:hover {
            background: linear-gradient(135deg, #005a9e 0%, #004578 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 120, 212, 0.4);
        }

        .export-container {
            padding: 20px 30px;
            background: linear-gradient(135deg, #fafafa 0%, #f0f0f0 100%);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .export-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .calendar-container {
            padding: 20px;
            background: white;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            justify-content: center;
        }

        .calendar-month {
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(0, 0, 0, 0.1);
            overflow: hidden;
            width: 100%;
            min-width: 350px;
        }

        .month-header {
            font-family: "Sora", "Noto Sans TC", "Noto Sans JP", sans-serif;
            font-weight: 600;
            background: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%);
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 1.3em;
        }

        .lunar-month-header {
            background: linear-gradient(135deg, #8B4513 0%, #654321 100%);
        }

        .era-info {
            font-size: 0.8em;
            opacity: 0.9;
            margin-top: 5px;
            line-height: 1.3;
        }

        .calendar-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        .calendar-table th {
            font-family: "Sora", "Noto Sans TC", "Noto Sans JP", sans-serif;
            font-weight: 600;
            background: linear-gradient(135deg, #f8f8f8 0%, #e8e8e8 100%);
            padding: 12px 4px;
            font-size: 0.9em;
            color: #333333;
            text-align: center;
            border-bottom: 2px solid rgba(0, 0, 0, 0.2);
            width: 14.28%;
            word-wrap: break-word;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            min-width: 0;
        }

        .calendar-table td {
            width: 14.28%;
            height: 60px;
            padding: 4px 2px;
            text-align: center;
            border: 1px solid rgba(0, 0, 0, 0.08);
            vertical-align: top;
            position: relative;
            background: white;
            word-wrap: break-word;
            overflow: hidden;
        }

        .date-number {
            font-family: "Sora", "Noto Sans TC", "Noto Sans JP", sans-serif;
            font-weight: 600;
            color: #333333;
            font-size: 0.95em;
            line-height: 1.2;
        }

        .lunar-date {
            font-family: "Noto Sans TC", sans-serif;
            font-weight: 500;
            font-size: 0.7em;
            color: #8B4513;
            margin-top: 1px;
            line-height: 1;
        }

        .solar-term {
            font-family: "Noto Sans TC", sans-serif;
            font-weight: 600;
            font-size: 0.6em;
            color: #228B22;
            margin-top: 2px;
            line-height: 1;
        }

        .japanese-reading {
            font-family: "Noto Sans JP", "Noto Sans TC", "Sora", sans-serif;
            font-weight: 500;
            font-size: 0.6em;
            color: #666666;
            margin-top: 1px;
            line-height: 1;
        }

        /* 台灣假日 - 白底紅字 */
        .taiwan-holiday {
            background-color: white !important;
            color: #ff0000 !important;
        }

        .taiwan-holiday .date-number {
            color: #ff0000 !important;
            font-weight: 700;
        }

        .taiwan-holiday .japanese-reading {
            color: #cc0000 !important;
        }

        .taiwan-holiday .holiday-name {
            color: #ff0000 !important;
        }

        /* 日本假日 - 白底橘字 */
        .japan-holiday {
            background-color: white !important;
            color: #ff6600 !important;
        }

        .japan-holiday .date-number {
            color: #ff6600 !important;
            font-weight: 700;
        }

        .japan-holiday .japanese-reading {
            color: #cc5200 !important;
        }

        .japan-holiday .holiday-name {
            color: #ff6600 !important;
        }

        /* 兩國都有假日時的處理 */
        .both-holiday {
            background: white !important;
            color: #ff0000 !important;
            position: relative;
        }

        .both-holiday::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255,0,0,0.1) 50%, rgba(255,102,0,0.1) 50%);
            pointer-events: none;
        }

        .both-holiday .date-number {
            color: #ff0000 !important;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }

        .both-holiday .japanese-reading {
            color: #cc0000 !important;
            position: relative;
            z-index: 1;
        }

        .both-holiday .holiday-name {
            color: #ff0000 !important;
            position: relative;
            z-index: 1;
        }

        .weekend {
            background-color: white !important;
        }

        .weekend .date-number {
            color: #ff0000 !important;
            font-weight: 700;
        }

        .weekend .japanese-reading {
            color: #cc0000 !important;
        }

        .other-month {
            background-color: rgba(0, 0, 0, 0.02);
        }

        .other-month .date-number {
            color: #cccccc;
        }

        .holiday-name {
            font-family: "Noto Sans TC", "Noto Sans JP", "Sora", sans-serif;
            font-weight: 500;
            font-size: 0.6em;
            color: #333333;
            margin-top: 2px;
            line-height: 1.1;
            word-break: break-all;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .ruby {
            ruby-align: center;
        }

        .ruby rt {
            font-size: 0.6em;
            color: inherit;
        }

        .loading {
            font-family: "Sora", "Noto Sans TC", "Noto Sans JP", sans-serif;
            font-weight: 400;
            text-align: center;
            padding: 50px;
            color: #666666;
            font-size: 1.1em;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(0, 0, 0, 0.2);
            border-top: 2px solid #333333;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message, .success-message {
            font-family: "Sora", "Noto Sans TC", "Noto Sans JP", sans-serif;
            font-weight: 500;
            padding: 15px 20px;
            border-radius: 20px;
            margin: 20px;
        }

        .error-message {
            background: linear-gradient(135deg, #ffebee 0%, #fde7e9 100%);
            color: #c62828;
            border-left: 4px solid #c62828;
        }

        .success-message {
            background: linear-gradient(135deg, #f0f0f0 0%, #e8e8e8 100%);
            color: #333333;
            border-left: 4px solid #666666;
        }

        .footer {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #333333;
            padding: 20px;
            text-align: center;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .footer-made {
            font-family: "Sora", "Noto Sans TC", "Noto Sans JP", sans-serif;
            font-weight: 500;
            font-size: 14px;
            opacity: 0.8;
            color: #666666;
        }

        .footer-heart {
            color: #ff4757;
            font-size: 1.1em;
            margin-left: 5px;
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @media (max-width: 1200px) {
            .control-group {
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
            }
        }

        @media (max-width: 768px) {
            .control-group {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .btn {
                padding: 12px 25px;
                font-size: 1em;
                margin-top: 15px;
            }
            
            .export-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn-export {
                width: 100%;
                max-width: 250px;
                justify-content: center;
                margin: 5px 0;
            }
            
            .calendar-grid {
                grid-template-columns: 1fr;
            }
            
            .calendar-month {
                min-width: unset;
                border-radius: 16px;
            }
            
            .calendar-table th,
            .calendar-table td {
                padding: 6px 2px;
                font-size: 0.8em;
                height: 50px;
            }

            .calendar-table th {
                font-size: 0.6em !important;
                padding: 6px 1px !important;
                line-height: 1.1 !important;
            }
            
            .holiday-name {
                font-size: 0.55em;
            }

            .container {
                border-radius: 16px;
            }
        }

        @media print {
            .controls, .button-group, .export-container, .footer {
                display: none !important;
            }
            
            .calendar-container {
                padding: 0;
            }
            
            .calendar-month {
                page-break-inside: avoid;
                margin-bottom: 20px;
                box-shadow: none;
                border: 1px solid #ccc;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
           <h1><a href="#" onclick="goHome()">月曆生成器</a></h1>
            <p class="subtitle">台灣和日本月曆（含完整年號對照）+ 農曆月曆</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <div class="form-group">
                    <label for="year">年份</label>
                    <input type="number" id="year" min="1661" max="2030" value="2025">
                </div>
                
                <div class="form-group">
                    <label for="startMonth">起始月份</label>
                    <select id="startMonth">
                        <option value="1">一月</option>
                        <option value="2">二月</option>
                        <option value="3">三月</option>
                        <option value="4">四月</option>
                        <option value="5">五月</option>
                        <option value="6">六月</option>
                        <option value="7">七月</option>
                        <option value="8">八月</option>
                        <option value="9">九月</option>
                        <option value="10">十月</option>
                        <option value="11">十一月</option>
                        <option value="12">十二月</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="monthCount">月份數量</label>
                    <select id="monthCount">
                        <option value="1">1 個月</option>
                        <option value="3">3 個月</option>
                        <option value="6">6 個月</option>
                        <option value="12" selected>12 個月</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="country">國家地區</label>
                    <select id="country">
                        <option value="taiwan">台灣</option>
                        <option value="taiwan-lunar">台灣農曆</option>
                        <option value="taiwan-en-full">台灣 （英文完整版）</option>
                        <option value="taiwan-en-short">台灣 （英文縮寫）</option>
                        <option value="taiwan-en-abbr">台灣 （英文簡寫）</option>
                        <option value="japan">日本（振假名）</option>
                        <option value="japan-hiragana">日本（平假名）</option>
                        <option value="japan-kanji">日本（漢字）</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="weekStart">週起始日</label>
                    <select id="weekStart">
                        <option value="0">星期日</option>
                        <option value="1" selected>星期一</option>
                    </select>
                </div>

                <div class="form-group">
                    <button class="btn btn-primary" onclick="generateCalendar()">
                        產生月曆
                    </button>
                </div>
            </div>
        </div>

        <div class="export-container" id="exportContainer">
            <div class="export-buttons">
                <button class="btn btn-export btn-excel" onclick="downloadExcel()">
                    下載成 Excel
                </button>
                <button class="btn btn-export btn-word" onclick="downloadWord()">
                    下載成 Word
                </button>
                <button class="btn btn-export btn-pdf" onclick="downloadPDF()">
                    下載成 PDF
                </button>
                <button class="btn btn-export btn-print" onclick="printCalendar()">
                    直接列印
                </button>
                <button class="btn btn-export btn-email" onclick="shareViaEmail()">
                    郵件分享
                </button>
            </div>
        </div>

        <div class="calendar-container" id="calendarContainer">
            <div class="loading" id="loading" style="display: none;">
                正在生成月曆...
            </div>
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>

        <div class="footer">
            <div class="footer-made">
                <span>Made in Taiwan with</span>
                <span class="footer-heart">❤️</span>
            </div>
        </div>
    </div>

    <script>
         // Home function
        function goHome() {
            // Clear all inputs and reset form
            clearAll();
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // 農曆計算基礎資料 (1900-2100)
        const lunarData = {
            // 農曆基礎年份數據 (每個元素包含該年的農曆月份天數信息)
            // 格式：前12位表示平月天數(0=29天,1=30天)，第13位表示閏月位置，第14-15位表示閏月天數
            years: [
                0x04bd8,0x04ae0,0x0a570,0x054d5,0x0d260,0x0d950,0x16554,0x056a0,0x09ad0,0x055d2, // 1900-1909
                0x04ae0,0x0a5b6,0x0a4d0,0x0d250,0x1d255,0x0b540,0x0d6a0,0x0ada2,0x095b0,0x14977, // 1910-1919
                0x04970,0x0a4b0,0x0b4b5,0x06a50,0x06d40,0x1ab54,0x02b60,0x09570,0x052f2,0x04970, // 1920-1929
                0x06566,0x0d4a0,0x0ea50,0x06e95,0x05ad0,0x02b60,0x186e3,0x092e0,0x1c8d7,0x0c950, // 1930-1939
                0x0d4a0,0x1d8a6,0x0b550,0x056a0,0x1a5b4,0x025d0,0x092d0,0x0d2b2,0x0a950,0x0b557, // 1940-1949
                0x06ca0,0x0b550,0x15355,0x04da0,0x0a5d0,0x14573,0x052d0,0x0a9a8,0x0e950,0x06aa0, // 1950-1959
                0x0aea6,0x0ab50,0x04b60,0x0aae4,0x0a570,0x05260,0x0f263,0x0d950,0x05b57,0x056a0, // 1960-1969
                0x096d0,0x04dd5,0x04ad0,0x0a4d0,0x0d4d4,0x0d250,0x0d558,0x0b540,0x0b5a0,0x155a5, // 1970-1979
                0x025d0,0x092d0,0x0d2b2,0x0a950,0x0b557,0x06ca0,0x0b550,0x15355,0x04da0,0x0a5b0, // 1980-1989
                0x14573,0x052b0,0x0a9a8,0x0e950,0x06aa0,0x0aea6,0x0ab50,0x04b60,0x0aae4,0x0a570, // 1990-1999
                0x05260,0x0f263,0x0d950,0x05b57,0x056a0,0x096d0,0x04dd5,0x04ad0,0x0a4d0,0x0d4d4, // 2000-2009
                0x0d250,0x0d558,0x0b540,0x0b6a0,0x195a6,0x095b0,0x049b0,0x0a974,0x0a4b0,0x0b27a, // 2010-2019
                0x06a50,0x06d40,0x0af46,0x0ab60,0x09570,0x04af5,0x04970,0x064b0,0x074a3,0x0ea50, // 2020-2029
                0x06b58,0x055c0,0x0ab60,0x096d5,0x092e0,0x0c960,0x0d954,0x0d4a0,0x0da50,0x07552, // 2030-2039
                0x056a0,0x0abb7,0x025d0,0x092d0,0x0cab5,0x0a950,0x0b4a0,0x0baa4,0x0ad50,0x055d9, // 2040-2049
                0x04ba0,0x0a5b0,0x15176,0x052b0,0x0a930,0x07954,0x06aa0,0x0ad50,0x05b52,0x04b60, // 2050-2059
                0x0a6e6,0x0a4e0,0x0d260,0x0ea65,0x0d530,0x05aa0,0x076a3,0x096d0,0x04afb,0x04ad0, // 2060-2069
                0x0a4d0,0x1d0b6,0x0d250,0x0d520,0x0dd45,0x0b5a0,0x056d0,0x055b2,0x049b0,0x0a577, // 2070-2079
                0x0a4b0,0x0aa50,0x1b255,0x06d20,0x0ada0,0x14b63 // 2080-2085
            ],
            baseYear: 1900, // 基準年份
            baseDate: new Date(1900, 0, 31) // 農曆1900年正月初一對應的公曆日期
        };

        // 24節氣資料 (每年節氣的大致日期)
        const solarTerms = {
            names: [
                '小寒', '大寒', '立春', '雨水', '驚蟄', '春分',
                '清明', '穀雨', '立夏', '小滿', '芒種', '夏至',
                '小暑', '大暑', '立秋', '處暑', '白露', '秋分',
                '寒露', '霜降', '立冬', '小雪', '大雪', '冬至'
            ],
            // 每個節氣在各月份的大致日期
            dates: [
                [6, 20], [1, 4], [2, 4], [2, 19], [3, 6], [3, 21],      // 小寒到春分
                [4, 5], [4, 20], [5, 6], [5, 21], [6, 6], [6, 21],     // 清明到夏至
                [7, 7], [7, 23], [8, 8], [8, 23], [9, 8], [9, 23],     // 小暑到秋分
                [10, 8], [10, 24], [11, 7], [11, 22], [12, 7], [12, 22] // 寒露到冬至
            ]
        };

        // 農曆年份天干地支
        const tianGan = ['庚', '辛', '壬', '癸', '甲', '乙', '丙', '丁', '戊', '己'];
        const diZhi = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
        const animals = ['鼠', '牛', '虎', '兔', '龍', '蛇', '馬', '羊', '猴', '雞', '狗', '豬'];

        // 農曆月份名稱
        const lunarMonths = ['正', '二', '三', '四', '五', '六', '七', '八', '九', '十', '冬', '臘'];
        const lunarDays = [
            '初一', '初二', '初三', '初四', '初五', '初六', '初七', '初八', '初九', '初十',
            '十一', '十二', '十三', '十四', '十五', '十六', '十七', '十八', '十九', '二十',
            '廿一', '廿二', '廿三', '廿四', '廿五', '廿六', '廿七', '廿八', '廿九', '三十'
        ];

        // 計算農曆年份天干地支
        function getLunarYearGanZhi(year) {
            const ganIndex = (year - 4) % 10;
            const zhiIndex = (year - 4) % 12;
            return tianGan[ganIndex] + diZhi[zhiIndex];
        }

        // 計算生肖
        function getAnimal(year) {
            return animals[(year - 4) % 12];
        }

        // 判斷農曆年是否為閏年及閏月位置
        function getLunarYearInfo(year) {
            const yearIndex = year - lunarData.baseYear;
            if (yearIndex < 0 || yearIndex >= lunarData.years.length) {
                return { isLeap: false, leapMonth: 0, monthDays: [] };
            }
            
            const yearData = lunarData.years[yearIndex];
            const isLeap = (yearData & 0xf) != 0;
            const leapMonth = yearData & 0xf;
            const monthDays = [];
            
            // 計算每個月的天數
            for (let i = 0; i < 12; i++) {
                monthDays.push((yearData & (0x10000 >> i)) ? 30 : 29);
            }
            
            // 如果有閏月，加入閏月天數
            if (isLeap) {
                const leapDays = (yearData & 0x10000) ? 30 : 29;
                monthDays.splice(leapMonth, 0, leapDays);
            }
            
            return { isLeap, leapMonth, monthDays };
        }

        // 公曆轉農曆
        function solarToLunar(year, month, day) {
            const targetDate = new Date(year, month - 1, day);
            const timeDiff = targetDate.getTime() - lunarData.baseDate.getTime();
            const daysDiff = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            
            if (daysDiff < 0) return null;
            
            let currentYear = lunarData.baseYear;
            let remainingDays = daysDiff;
            
            // 找到對應的農曆年份
            while (remainingDays > 0) {
                const yearInfo = getLunarYearInfo(currentYear);
                const yearDays = yearInfo.monthDays.reduce((sum, days) => sum + days, 0);
                
                if (remainingDays >= yearDays) {
                    remainingDays -= yearDays;
                    currentYear++;
                } else {
                    break;
                }
            }
            
            // 找到對應的農曆月份和日期
            const yearInfo = getLunarYearInfo(currentYear);
            let currentMonth = 1;
            
            while (remainingDays > 0 && currentMonth <= yearInfo.monthDays.length) {
                const monthDays = yearInfo.monthDays[currentMonth - 1];
                
                if (remainingDays >= monthDays) {
                    remainingDays -= monthDays;
                    currentMonth++;
                } else {
                    break;
                }
            }
            
            const currentDay = remainingDays + 1;
            
            // 判斷是否為閏月
            let isLeapMonth = false;
            let displayMonth = currentMonth;
            
            if (yearInfo.isLeap && currentMonth > yearInfo.leapMonth) {
                displayMonth = currentMonth - 1;
                if (currentMonth === yearInfo.leapMonth + 1) {
                    isLeapMonth = true;
                    displayMonth = yearInfo.leapMonth;
                }
            }
            
            return {
                year: currentYear,
                month: displayMonth,
                day: currentDay,
                isLeapMonth: isLeapMonth,
                ganZhi: getLunarYearGanZhi(currentYear),
                animal: getAnimal(currentYear)
            };
        }

        // 獲取24節氣
        function getSolarTerm(year, month, day) {
            for (let i = 0; i < solarTerms.dates.length; i++) {
                const [termMonth, termDay] = solarTerms.dates[i];
                // 考慮節氣可能有±2天的誤差
                if (month === termMonth && Math.abs(day - termDay) <= 2) {
                    return solarTerms.names[i];
                }
            }
            return null;
        }

        // 台灣歷史年號資料
        const taiwanEras = [
            // 明鄭時期 (永曆年號)
            { name: '永曆', start: new Date(1661, 0, 1), end: new Date(1683, 11, 31), baseYear: 1647 }, // 永曆1年=1647年
            // 清朝年號
            { name: '康熙', start: new Date(1683, 0, 1), end: new Date(1722, 11, 31), baseYear: 1662 }, // 康熙1年=1662年，但台灣從1683年開始
            { name: '雍正', start: new Date(1723, 0, 1), end: new Date(1735, 11, 31), baseYear: 1723 },
            { name: '乾隆', start: new Date(1736, 0, 1), end: new Date(1795, 11, 31), baseYear: 1736 },
            { name: '嘉慶', start: new Date(1796, 0, 1), end: new Date(1820, 11, 31), baseYear: 1796 },
            { name: '道光', start: new Date(1821, 0, 1), end: new Date(1850, 11, 31), baseYear: 1821 },
            { name: '咸豐', start: new Date(1851, 0, 1), end: new Date(1861, 11, 31), baseYear: 1851 },
            { name: '同治', start: new Date(1862, 0, 1), end: new Date(1874, 11, 31), baseYear: 1862 },
            { name: '光緒', start: new Date(1875, 0, 1), end: new Date(1908, 11, 31), baseYear: 1875 },
            { name: '宣統', start: new Date(1909, 0, 1), end: new Date(1912, 0, 31), baseYear: 1909 }, // 台灣1912年1月結束
            // 日治時期
            { name: '明治', start: new Date(1895, 0, 1), end: new Date(1912, 6, 30), baseYear: 1868 }, // 台灣從1895年開始
            { name: '大正', start: new Date(1912, 6, 30), end: new Date(1926, 11, 25), baseYear: 1912 },
            { name: '昭和', start: new Date(1926, 11, 25), end: new Date(1945, 7, 15), baseYear: 1926 }, // 台灣至1945年8月15日
            // 中華民國時期
            { name: '民國', start: new Date(1945, 9, 25), end: new Date(2099, 11, 31), baseYear: 1912 } // 台灣光復從1945年10月25日開始
        ];

        // 日本年號資料
        const japaneseEras = [
            { name: '明治', nameKana: 'めいじ', start: new Date(1868, 9, 23), end: new Date(1912, 6, 30) }, // 明治45年7月30日
            { name: '大正', nameKana: 'たいしょう', start: new Date(1912, 6, 30), end: new Date(1926, 11, 25) }, // 大正15年12月25日
            { name: '昭和', nameKana: 'しょうわ', start: new Date(1926, 11, 25), end: new Date(1989, 0, 7) }, // 昭和64年1月7日
            { name: '平成', nameKana: 'へいせい', start: new Date(1989, 0, 8), end: new Date(2019, 3, 30) }, // 平成31年4月30日
            { name: '令和', nameKana: 'れいわ', start: new Date(2019, 4, 1), end: new Date(2099, 11, 31) } // 令和繼續中
        ];

        // 獲取台灣年號
        function getTaiwanEra(year, month) {
            const date = new Date(year, month - 1, 1);
            for (const era of taiwanEras) {
                if (date >= era.start && date <= era.end) {
                    let eraYear;
                    if (era.name === '永曆') {
                        // 永曆年號特殊計算：永曆1年=1647年
                        eraYear = year - 1646;
                    } else if (era.name === '康熙' && year >= 1683) {
                        // 康熙在台灣從1683年開始，但康熙1年=1662年
                        eraYear = year - 1661;
                    } else if (era.name === '明治' && year >= 1895) {
                        // 明治在台灣從1895年開始，但明治1年=1868年
                        eraYear = year - 1867;
                    } else if (era.name === '民國' && year >= 1945) {
                        // 民國在台灣從1945年開始，但民國1年=1912年
                        eraYear = year - 1911;
                    } else {
                        eraYear = year - era.baseYear + 1;
                    }
                    return {
                        name: era.name,
                        year: eraYear === 1 ? '元' : eraYear
                    };
                }
            }
            return null;
        }

        // 獲取日本年號
        function getJapaneseEra(year, month) {
            const date = new Date(year, month - 1, 1);
            for (const era of japaneseEras) {
                if (date >= era.start && date <= era.end) {
                    const eraYear = year - era.start.getFullYear() + 1;
                    return {
                        name: era.name,
                        nameKana: era.nameKana,
                        year: eraYear === 1 ? '元' : eraYear
                    };
                }
            }
            return null;
        }

        // 獲取台灣民國年份
        function getROCYear(year) {
            return year - 1911;
        }

        // 根據政府行政機關辦公日曆表更新的台灣節日資料
        const holidays = {
            taiwan: {
                2025: {
                    '1-1': '中華民國開國紀念日',
                    '1-27': '農曆除夕前一日',
                    '1-28': '農曆除夕',
                    '1-29': '農曆春節',
                    '1-30': '農曆春節',
                    '1-31': '農曆春節',
                    '2-28': '和平紀念日',
                    '4-3': '兒童節補假',
                    '4-4': '兒童節',
                    '4-5': '民族掃墓節',
                    '5-1': '勞動節',
                    '5-30': '端午節補假',
                    '5-31': '端午節',
                    '9-28': '孔子誕辰紀念日',
                    '9-29': '孔子誕辰紀念日補假',
                    '10-6': '中秋節',
                    '10-10': '國慶日',
                    '10-24': '臺灣光復節補假',
                    '10-25': '臺灣光復節',
                    '12-25': '行憲紀念日'
                },
                2026: {
                    '1-1': '中華民國開國紀念日',
                    '2-15': '農曆除夕前一日',
                    '2-16': '農曆除夕',
                    '2-17': '農曆春節',
                    '2-18': '農曆春節',
                    '2-19': '農曆春節',
                    '2-20': '農曆除夕前一日補假',
                    '2-27': '和平紀念日補假',
                    '2-28': '和平紀念日',
                    '4-3': '兒童節補假',
                    '4-4': '兒童節',
                    '4-5': '民族掃墓節',
                    '4-6': '民族掃墓節補假',
                    '5-1': '勞動節',
                    '6-19': '端午節',
                    '9-25': '中秋節',
                    '9-28': '孔子誕辰紀念日',
                    '10-9': '國慶日補假',
                    '10-10': '國慶日',
                    '10-24': '臺灣光復節補假',
                    '10-25': '臺灣光復節',
                    '12-25': '行憲紀念日'
                }
            },
            japan: {
                // 振假名版本
                ruby: {
                    2025: {
                        '1-1': '<ruby>元日<rt>がんじつ</rt></ruby>',
                        '1-13': '<ruby>成人<rt>せいじん</rt></ruby>の<ruby>日<rt>ひ</rt></ruby>',
                        '2-11': '<ruby>建国記念<rt>けんこくきねん</rt></ruby>の<ruby>日<rt>ひ</rt></ruby>',
                        '2-23': '<ruby>天皇誕生日<rt>てんのうたんじょうび</rt></ruby>',
                        '3-20': '<ruby>春分<rt>しゅんぶん</rt></ruby>の<ruby>日<rt>ひ</rt></ruby>',
                        '4-29': '<ruby>昭和<rt>しょうわ</rt></ruby>の<ruby>日<rt>ひ</rt></ruby>',
                        '5-3': '<ruby>憲法記念日<rt>けんぽうきねんび</rt></ruby>',
                        '5-4': 'みどりの<ruby>日<rt>ひ</rt></ruby>',
                        '5-5': 'こどもの<ruby>日<rt>ひ</rt></ruby>',
                        '7-21': '<ruby>海<rt>うみ</rt></ruby>の<ruby>日<rt>ひ</rt></ruby>',
                        '8-11': '<ruby>山<rt>やま</rt></ruby>の<ruby>日<rt>ひ</rt></ruby>',
                        '9-15': '<ruby>敬老<rt>けいろう</rt></ruby>の<ruby>日<rt>ひ</rt></ruby>',
                        '9-23': '<ruby>秋分<rt>しゅうぶん</rt></ruby>の<ruby>日<rt>ひ</rt></ruby>',
                        '10-13': 'スポーツの<ruby>日<rt>ひ</rt></ruby>',
                        '11-3': '<ruby>文化<rt>ぶんか</rt></ruby>の<ruby>日<rt>ひ</rt></ruby>',
                        '11-23': '<ruby>勤労感謝<rt>きんろうかんしゃ</rt></ruby>の<ruby>日<rt>ひ</rt></ruby>'
                    }
                },
                // 平假名版本
                hiragana: {
                    2025: {
                        '1-1': 'がんじつ',
                        '1-13': 'せいじんのひ',
                        '2-11': 'けんこくきねんのひ',
                        '2-23': 'てんのうたんじょうび',
                        '3-20': 'しゅんぶんのひ',
                        '4-29': 'しょうわのひ',
                        '5-3': 'けんぽうきねんび',
                        '5-4': 'みどりのひ',
                        '5-5': 'こどものひ',
                        '7-21': 'うみのひ',
                        '8-11': 'やまのひ',
                        '9-15': 'けいろうのひ',
                        '9-23': 'しゅうぶんのひ',
                        '10-13': 'スポーツのひ',
                        '11-3': 'ぶんかのひ',
                        '11-23': 'きんろうかんしゃのひ'
                    }
                },
                // 漢字版本
                kanji: {
                    2025: {
                        '1-1': '元日',
                        '1-13': '成人の日',
                        '2-11': '建国記念の日',
                        '2-23': '天皇誕生日',
                        '3-20': '春分の日',
                        '4-29': '昭和の日',
                        '5-3': '憲法記念日',
                        '5-4': 'みどりの日',
                        '5-5': 'こどもの日',
                        '7-21': '海の日',
                        '8-11': '山の日',
                        '9-15': '敬老の日',
                        '9-23': '秋分の日',
                        '10-13': 'スポーツの日',
                        '11-3': '文化の日',
                        '11-23': '勤労感謝の日'
                    }
                }
            }
        };

        // 日文月份讀音
        const japaneseMonths = {
            1: 'いちがつ', 2: 'にがつ', 3: 'さんがつ', 4: 'しがつ',
            5: 'ごがつ', 6: 'ろくがつ', 7: 'しちがつ', 8: 'はちがつ',
            9: 'くがつ', 10: 'じゅうがつ', 11: 'じゅういちがつ', 12: 'じゅうにがつ'
        };

        // 日文日期讀音
        const japaneseDays = {
            1: 'ついたち', 2: 'ふつか', 3: 'みっか', 4: 'よっか', 5: 'いつか',
            6: 'むいか', 7: 'なのか', 8: 'ようか', 9: 'ここのか', 10: 'とおか',
            11: 'じゅういちにち', 12: 'じゅうににち', 13: 'じゅうさんにち', 14: 'じゅうよっか', 15: 'じゅうごにち',
            16: 'じゅうろくにち', 17: 'じゅうしちにち', 18: 'じゅうはちにち', 19: 'じゅうくにち', 20: 'はつか',
            21: 'にじゅういちにち', 22: 'にじゅうににち', 23: 'にじゅうさんにち', 24: 'にじゅうよっか', 25: 'にじゅうごにち',
            26: 'にじゅうろくにち', 27: 'にじゅうしちにち', 28: 'にじゅうはちにち', 29: 'にじゅうくにち', 30: 'さんじゅうにち',
            31: 'さんじゅういちにち'
        };

        let currentCalendarData = [];

        function generateCalendar() {
            const year = parseInt(document.getElementById('year').value);
            const startMonth = parseInt(document.getElementById('startMonth').value);
            const monthCount = parseInt(document.getElementById('monthCount').value);
            const country = document.getElementById('country').value;
            const weekStart = parseInt(document.getElementById('weekStart').value);

            const loading = document.getElementById('loading');
            const calendarGrid = document.getElementById('calendarGrid');

            loading.style.display = 'block';
            calendarGrid.innerHTML = '';

            setTimeout(() => {
                currentCalendarData = [];
                calendarGrid.innerHTML = '';

                for (let i = 0; i < monthCount; i++) {
                    let currentMonth = startMonth + i;
                    let currentYear = year;

                    if (currentMonth > 12) {
                        currentMonth = currentMonth - 12;
                        currentYear = year + 1;
                    }

                    const monthData = createMonthCalendar(currentYear, currentMonth, country, weekStart);
                    currentCalendarData.push(monthData);
                    calendarGrid.appendChild(createMonthElement(monthData, country, weekStart));
                }

                // 顯示匯出功能區（現在已經預設顯示）

                loading.style.display = 'none';
            }, 500);
        }

        function createMonthCalendar(year, month, country, weekStart) {
            const monthNames = [
                '', '一月', '二月', '三月', '四月', '五月', '六月',
                '七月', '八月', '九月', '十月', '十一月', '十二月'
            ];

            const daysInMonth = new Date(year, month, 0).getDate();
            const firstDayOfMonth = new Date(year, month - 1, 1).getDay();
            
            let adjustedFirstDay = (firstDayOfMonth - weekStart + 7) % 7;
            
            const monthData = {
                year: year,
                month: month,
                monthName: getMonthHeaderText(year, month, country),
                days: [],
                weekStart: weekStart
            };

            // 填入當月的日期
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month - 1, day);
                const dayOfWeek = date.getDay();
                const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                
                const dateKey = `${month}-${day}`;
                const dayHolidays = getHolidays(year, dateKey, country);

                // 農曆相關資訊
                let lunarInfo = null;
                let solarTerm = null;
                
                if (country === 'taiwan-lunar') {
                    lunarInfo = solarToLunar(year, month, day);
                    solarTerm = getSolarTerm(year, month, day);
                }

                monthData.days.push({
                    date: day,
                    isCurrentMonth: true,
                    isWeekend: isWeekend,
                    holidays: dayHolidays,
                    lunarInfo: lunarInfo,
                    solarTerm: solarTerm
                });
            }

            // 填入下個月的日期
            const totalCells = Math.ceil(monthData.days.length / 7) * 7;
            const nextMonth = month === 12 ? 1 : month + 1;
            let nextDay = 1;

            for (let i = monthData.days.length; i < totalCells; i++) {
                monthData.days.push({
                    date: nextDay++,
                    isCurrentMonth: false,
                    isWeekend: false,
                    holidays: []
                });
            }

            return monthData;
        }

        function getMonthHeaderText(year, month, country) {
            const rocYear = getROCYear(year);
            const taiwanEra = getTaiwanEra(year, month);
            const japaneseEra = getJapaneseEra(year, month);
            
            switch(country) {
                case 'taiwan-lunar':
                    // 農曆月曆標題
                    const lunarSample = solarToLunar(year, month, 15); // 取月中的農曆資訊
                    if (lunarSample) {
                        return `${year} 年 ${month} 月<div class="era-info">農曆 ${lunarSample.ganZhi}年 (${lunarSample.animal}年) / 民國 ${rocYear} 年</div>`;
                    }
                    return `${year} 年 ${month} 月<div class="era-info">民國 ${rocYear} 年</div>`;
                    
                case 'taiwan-en-full':
                case 'taiwan-en-short':
                case 'taiwan-en-abbr':
                    const monthNames = ['', 'January', 'February', 'March', 'April', 'May', 'June',
                                       'July', 'August', 'September', 'October', 'November', 'December'];
                    let eraInfo = `民國 ${rocYear} 年`;
                    if (taiwanEra && taiwanEra.name !== '民國') {
                        if (year < 1912) {
                            // 1912年以前只顯示歷史年號
                            eraInfo = `${taiwanEra.name}${taiwanEra.year}年`;
                        } else {
                            // 1912年以後顯示雙重年號
                            eraInfo = `${taiwanEra.name}${taiwanEra.year}年 / 民國 ${rocYear} 年`;
                        }
                    }
                    return `${monthNames[month]} ${year}<div class="era-info">${eraInfo}</div>`;
                    
                case 'japan':
                    if (japaneseEra) {
                        return `${year}<ruby>年<rt>ねん</rt></ruby> ${month}<ruby>月<rt>${japaneseMonths[month]}</rt></ruby><div class="era-info"><ruby>${japaneseEra.name}<rt>${japaneseEra.nameKana}</rt></ruby>${japaneseEra.year}<ruby>年<rt>ねん</rt></ruby></div>`;
                    }
                    return `${year}<ruby>年<rt>ねん</rt></ruby> ${month}<ruby>月<rt>${japaneseMonths[month]}</rt></ruby>`;
                    
                case 'japan-hiragana':
                    if (japaneseEra) {
                        return `${year}ねん ${month}がつ<div class="era-info">${japaneseEra.nameKana}${japaneseEra.year}ねん</div>`;
                    }
                    return `${year}ねん ${month}がつ`;
                    
                case 'japan-kanji':
                    if (japaneseEra) {
                        return `${year}年 ${month}月<div class="era-info">${japaneseEra.name}${japaneseEra.year}年</div>`;
                    }
                    return `${year}年 ${month}月`;
                    
                default:
                    let taiwanEraInfo = `民國 ${rocYear} 年`;
                    if (taiwanEra && taiwanEra.name !== '民國') {
                        if (year < 1912) {
                            // 1912年以前只顯示歷史年號
                            taiwanEraInfo = `${taiwanEra.name}${taiwanEra.year}年`;
                        } else {
                            // 1912年以後顯示雙重年號
                            taiwanEraInfo = `${taiwanEra.name}${taiwanEra.year}年 / 民國 ${rocYear} 年`;
                        }
                    }
                    return `${year} 年 ${month} 月<div class="era-info">${taiwanEraInfo}</div>`;
            }
        }

        function getHolidays(year, dateKey, country) {
            const holidayList = [];
            
            // 台灣英文版不顯示假日
            if (country === 'taiwan-en-full' || country === 'taiwan-en-short' || country === 'taiwan-en-abbr') {
                return holidayList;
            }
            
            // 農曆版本不顯示假日，專注於農曆資訊
            if (country === 'taiwan-lunar') {
                return holidayList;
            }
            
            if (country === 'taiwan' || country === 'both') {
                if (holidays.taiwan[year] && holidays.taiwan[year][dateKey]) {
                    holidayList.push({
                        name: holidays.taiwan[year][dateKey],
                        country: 'taiwan'
                    });
                }
            }
            
            if (country === 'japan' || country === 'both') {
                if (holidays.japan.ruby[year] && holidays.japan.ruby[year][dateKey]) {
                    holidayList.push({
                        name: holidays.japan.ruby[year][dateKey],
                        country: 'japan'
                    });
                }
            }

            if (country === 'japan-hiragana') {
                if (holidays.japan.hiragana[year] && holidays.japan.hiragana[year][dateKey]) {
                    holidayList.push({
                        name: holidays.japan.hiragana[year][dateKey],
                        country: 'japan'
                    });
                }
            }

            if (country === 'japan-kanji') {
                if (holidays.japan.kanji[year] && holidays.japan.kanji[year][dateKey]) {
                    holidayList.push({
                        name: holidays.japan.kanji[year][dateKey],
                        country: 'japan'
                    });
                }
            }
            
            return holidayList;
        }

        function createMonthElement(monthData, country, weekStart) {
            const monthDiv = document.createElement('div');
            monthDiv.className = 'calendar-month';
            
            // 農曆月曆使用不同的標題樣式
            if (country === 'taiwan-lunar') {
                monthDiv.innerHTML = `
                    <div class="month-header lunar-month-header">
                        ${monthData.monthName}
                    </div>
                    <table class="calendar-table">
                        <thead>
                            <tr>
                                ${getWeekHeaders(country, weekStart)}
                            </tr>
                        </thead>
                        <tbody>
                            ${createWeekRows(monthData.days, country)}
                        </tbody>
                    </table>
                `;
            } else {
                const weekHeaders = getWeekHeaders(country, weekStart);
                
                monthDiv.innerHTML = `
                    <div class="month-header">
                        ${monthData.monthName}
                    </div>
                    <table class="calendar-table">
                        <thead>
                            <tr>
                                ${weekHeaders}
                            </tr>
                        </thead>
                        <tbody>
                            ${createWeekRows(monthData.days, country)}
                        </tbody>
                    </table>
                `;
            }

            return monthDiv;
        }

        function getWeekHeaders(country, weekStart) {
            const baseHeaders = weekStart === 0 
                ? ['日', '一', '二', '三', '四', '五', '六']
                : ['一', '二', '三', '四', '五', '六', '日'];

            const englishHeadersFull = weekStart === 0 
                ? ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']
                : ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];

            const englishHeadersShort = weekStart === 0 
                ? ['S', 'M', 'T', 'W', 'T', 'F', 'S']
                : ['M', 'T', 'W', 'T', 'F', 'S', 'S'];

            const englishHeadersAbbr = weekStart === 0 
                ? ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
                : ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];

            switch(country) {
                case 'taiwan-lunar':
                    // 農曆版本使用標準中文星期
                    return baseHeaders.map((day, index) => {
                        const isWeekend = (weekStart === 0 && (index === 0 || index === 6)) || 
                                         (weekStart === 1 && (index === 5 || index === 6));
                        const style = isWeekend ? 'color: #ff0000; font-weight: 700;' : 'color: #333333;';
                        return `<th style="${style}">${day}</th>`;
                    }).join('');
                    
                case 'taiwan-en-full':
                    return englishHeadersFull.map((day, index) => {
                        const isWeekend = (weekStart === 0 && (index === 0 || index === 6)) || 
                                         (weekStart === 1 && (index === 5 || index === 6));
                        const style = isWeekend ? 'color: #ff0000; font-weight: 700;' : 'color: #333333;';
                        return `<th style="font-size: 0.65em; padding: 8px 2px; line-height: 1.2; ${style}">${day}</th>`;
                    }).join('');

                case 'taiwan-en-short':
                    return englishHeadersShort.map((day, index) => {
                        const isWeekend = (weekStart === 0 && (index === 0 || index === 6)) || 
                                         (weekStart === 1 && (index === 5 || index === 6));
                        const style = isWeekend ? 'color: #ff0000; font-weight: 700;' : 'color: #333333;';
                        return `<th style="${style}">${day}</th>`;
                    }).join('');

                case 'taiwan-en-abbr':
                    return englishHeadersAbbr.map((day, index) => {
                        const isWeekend = (weekStart === 0 && (index === 0 || index === 6)) || 
                                         (weekStart === 1 && (index === 5 || index === 6));
                        const style = isWeekend ? 'color: #ff0000; font-weight: 700;' : 'color: #333333;';
                        return `<th style="${style}">${day}</th>`;
                    }).join('');

                case 'japan':
                    const weekHeadersJapanese = weekStart === 0 
                        ? [
                            '<ruby>日曜日<rt>にちようび</rt></ruby>',
                            '<ruby>月曜日<rt>げつようび</rt></ruby>',
                            '<ruby>火曜日<rt>かようび</rt></ruby>',
                            '<ruby>水曜日<rt>すいようび</rt></ruby>',
                            '<ruby>木曜日<rt>もくようび</rt></ruby>',
                            '<ruby>金曜日<rt>きんようび</rt></ruby>',
                            '<ruby>土曜日<rt>どようび</rt></ruby>'
                        ]
                        : [
                            '<ruby>月曜日<rt>げつようび</rt></ruby>',
                            '<ruby>火曜日<rt>かようび</rt></ruby>',
                            '<ruby>水曜日<rt>すいようび</rt></ruby>',
                            '<ruby>木曜日<rt>もくようび</rt></ruby>',
                            '<ruby>金曜日<rt>きんようび</rt></ruby>',
                            '<ruby>土曜日<rt>どようび</rt></ruby>',
                            '<ruby>日曜日<rt>にちようび</rt></ruby>'
                        ];
                    return weekHeadersJapanese.map(day => `<th style="font-size: 0.8em; color: #333333;">${day}</th>`).join('');

                case 'japan-hiragana':
                    const weekHeadersHiragana = weekStart === 0 
                        ? ['にちようび', 'げつようび', 'かようび', 'すいようび', 'もくようび', 'きんようび', 'どようび']
                        : ['げつようび', 'かようび', 'すいようび', 'もくようび', 'きんようび', 'どようび', 'にちようび'];
                    return weekHeadersHiragana.map(day => `<th style="font-size: 0.75em; color: #333333;">${day}</th>`).join('');

                case 'japan-kanji':
                    const weekHeadersKanji = weekStart === 0 
                        ? ['日曜日', '月曜日', '火曜日', '水曜日', '木曜日', '金曜日', '土曜日']
                        : ['月曜日', '火曜日', '水曜日', '木曜日', '金曜日', '土曜日', '日曜日'];
                    return weekHeadersKanji.map(day => `<th style="font-size: 0.85em; color: #333333;">${day}</th>`).join('');

                default:
                    return baseHeaders.map((day, index) => {
                        const isWeekend = (weekStart === 0 && (index === 0 || index === 6)) || 
                                         (weekStart === 1 && (index === 5 || index === 6));
                        const style = isWeekend ? 'color: #ff0000; font-weight: 700;' : 'color: #333333;';
                        return `<th style="${style}">${day}</th>`;
                    }).join('');
            }
        }

        function createWeekRows(days, country) {
            let html = '';
            for (let i = 0; i < days.length; i += 7) {
                html += '<tr>';
                for (let j = 0; j < 7; j++) {
                    const day = days[i + j];
                    if (day) {
                        let className = '';
                        if (!day.isCurrentMonth) {
                            className = 'other-month';
                        } else if (day.holidays.length > 0) {
                            // 區分台灣和日本假期的顏色
                            const hasJapanHoliday = day.holidays.some(h => h.country === 'japan');
                            const hasTaiwanHoliday = day.holidays.some(h => h.country === 'taiwan');
                            
                            if (hasJapanHoliday && hasTaiwanHoliday) {
                                className = 'both-holiday';
                            } else if (hasJapanHoliday) {
                                className = 'japan-holiday';
                            } else if (hasTaiwanHoliday) {
                                className = 'taiwan-holiday';
                            }
                        } else if (day.isWeekend) {
                            className = 'weekend';
                        }

                        const holidayNames = day.holidays.map(h => 
                            `<div class="holiday-name">${h.name}</div>`
                        ).join('');

                        let japaneseReading = '';
                        if ((country.includes('japan')) && day.isCurrentMonth) {
                            japaneseReading = `<div class="japanese-reading">${japaneseDays[day.date]}</div>`;
                        }

                        let lunarContent = '';
                        if (country === 'taiwan-lunar' && day.isCurrentMonth && day.lunarInfo) {
                            const lunar = day.lunarInfo;
                            let lunarDateText = '';
                            
                            if (lunar.day === 1) {
                                // 農曆初一顯示月份
                                if (lunar.isLeapMonth) {
                                    lunarDateText = `閏${lunarMonths[lunar.month - 1]}月`;
                                } else {
                                    lunarDateText = `${lunarMonths[lunar.month - 1]}月`;
                                }
                            } else {
                                lunarDateText = lunarDays[lunar.day - 1];
                            }
                            
                            lunarContent = `<div class="lunar-date">${lunarDateText}</div>`;
                            
                            // 顯示24節氣
                            if (day.solarTerm) {
                                lunarContent += `<div class="solar-term">${day.solarTerm}</div>`;
                            }
                        }

                        html += `
                            <td class="${className}">
                                <div class="date-number">${day.date}</div>
                                ${japaneseReading}
                                ${lunarContent}
                                ${holidayNames}
                            </td>
                        `;
                    }
                }
                html += '</tr>';
            }
            return html;
        }

        function clearAll() {
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const currentMonth = currentDate.getMonth() + 1;
            
            document.getElementById('year').value = currentYear;
            document.getElementById('startMonth').value = currentMonth;
            document.getElementById('monthCount').value = 12;
            document.getElementById('country').value = 'taiwan';
            document.getElementById('weekStart').value = 1;
            document.getElementById('calendarGrid').innerHTML = '';
            // 保持匯出按鈕可見，不隱藏
        }

        // 匯出功能
        function downloadExcel() {
            if (!currentCalendarData.length) {
                showMessage('請先產生月曆再匯出', 'error');
                return;
            }

            try {
                // 建立工作簿
                const wb = {
                    SheetNames: [],
                    Sheets: {}
                };

                const country = document.getElementById('country').value;
                const weekStart = parseInt(document.getElementById('weekStart').value);

                currentCalendarData.forEach((monthData, index) => {
                    const sheetName = `${monthData.year}年${monthData.month}月`;
                    wb.SheetNames.push(sheetName);

                    // 建立工作表資料
                    const wsData = [];
                    
                    // 標題行（移除HTML標籤並保留完整年號資訊）
                    const cleanTitle = monthData.monthName.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim();
                    wsData.push([cleanTitle]);
                    wsData.push([]);

                    // 星期標題
                    let weekHeaders;
                    if (country.includes('taiwan-en')) {
                        if (country === 'taiwan-en-full') {
                            weekHeaders = weekStart === 0 
                                ? ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']
                                : ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
                        } else if (country === 'taiwan-en-short') {
                            weekHeaders = weekStart === 0 
                                ? ['S', 'M', 'T', 'W', 'T', 'F', 'S']
                                : ['M', 'T', 'W', 'T', 'F', 'S', 'S'];
                        } else { // taiwan-en-abbr
                            weekHeaders = weekStart === 0 
                                ? ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
                                : ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
                        }
                    } else if (country.includes('japan')) {
                        if (country === 'japan-hiragana') {
                            weekHeaders = weekStart === 0 
                                ? ['にちようび', 'げつようび', 'かようび', 'すいようび', 'もくようび', 'きんようび', 'どようび']
                                : ['げつようび', 'かようび', 'すいようび', 'もくようび', 'きんようび', 'どようび', 'にちようび'];
                        } else if (country === 'japan-kanji') {
                            weekHeaders = weekStart === 0 
                                ? ['日曜日', '月曜日', '火曜日', '水曜日', '木曜日', '金曜日', '土曜日']
                                : ['月曜日', '火曜日', '水曜日', '木曜日', '金曜日', '土曜日', '日曜日'];
                        } else { // japan (ruby)
                            weekHeaders = weekStart === 0 
                                ? ['日曜日', '月曜日', '火曜日', '水曜日', '木曜日', '金曜日', '土曜日']
                                : ['月曜日', '火曜日', '水曜日', '木曜日', '金曜日', '土曜日', '日曜日'];
                        }
                    } else {
                        weekHeaders = weekStart === 0 
                            ? ['日', '一', '二', '三', '四', '五', '六']
                            : ['一', '二', '三', '四', '五', '六', '日'];
                    }
                    wsData.push(weekHeaders);

                    // 月曆資料
                    const days = monthData.days;
                    for (let i = 0; i < days.length; i += 7) {
                        const weekRow = [];
                        for (let j = 0; j < 7; j++) {
                            const day = days[i + j];
                            if (day && day.isCurrentMonth) {
                                let cellValue = day.date.toString();
                                
                                // 加入日文讀音（如果是日文模式）
                                if (country.includes('japan') && japaneseDays[day.date]) {
                                    if (country === 'japan-hiragana') {
                                        cellValue += `\n(${japaneseDays[day.date]})`;
                                    } else if (country === 'japan-kanji') {
                                        cellValue += `\n(${japaneseDays[day.date]})`;
                                    } else { // japan (ruby)
                                        cellValue += `\n(${japaneseDays[day.date]})`;
                                    }
                                }
                                
                                // 加入農曆資訊（如果是農曆模式）
                                if (country === 'taiwan-lunar' && day.lunarInfo) {
                                    const lunar = day.lunarInfo;
                                    let lunarText = '';
                                    
                                    if (lunar.day === 1) {
                                        lunarText = lunar.isLeapMonth ? 
                                            `閏${lunarMonths[lunar.month - 1]}月` : 
                                            `${lunarMonths[lunar.month - 1]}月`;
                                    } else {
                                        lunarText = lunarDays[lunar.day - 1];
                                    }
                                    
                                    cellValue += `\n${lunarText}`;
                                    
                                    if (day.solarTerm) {
                                        cellValue += `\n${day.solarTerm}`;
                                    }
                                }
                                
                                // 加入假日資訊
                                if (day.holidays.length > 0) {
                                    const holidayText = day.holidays.map(h => h.name.replace(/<[^>]*>/g, '')).join('\n');
                                    cellValue += '\n' + holidayText;
                                }
                                weekRow.push(cellValue);
                            } else if (day && !day.isCurrentMonth) {
                                // 其他月份的日期以淡色顯示
                                weekRow.push(`(${day.date})`);
                            } else {
                                weekRow.push('');
                            }
                        }
                        wsData.push(weekRow);
                    }

                    // 轉換為工作表
                    const ws = XLSX.utils.aoa_to_sheet(wsData);
                    
                    // 設定欄寬
                    ws['!cols'] = Array(7).fill({ width: 18 });
                    
                    wb.Sheets[sheetName] = ws;
                });

                // 下載檔案
                const filename = `月曆_${currentCalendarData[0].year}年_${new Date().toISOString().slice(0,10)}.xlsx`;
                XLSX.writeFile(wb, filename);
                
                showMessage('Excel 檔案已成功下載', 'success');
            } catch (error) {
                console.error('Excel 匯出錯誤:', error);
                showMessage('Excel 匯出失敗，請稍後再試', 'error');
            }
        }

        function downloadWord() {
            if (!currentCalendarData.length) {
                showMessage('請先產生月曆再匯出', 'error');
                return;
            }

            try {
                const country = document.getElementById('country').value;
                const weekStart = parseInt(document.getElementById('weekStart').value);

                let docContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>月曆</title>
                    <style>
                        body { 
                            font-family: 'Microsoft JhengHei', 'Noto Sans TC', 'Noto Sans JP', sans-serif; 
                            margin: 20px; 
                            line-height: 1.4;
                        }
                        .month-title { 
                            text-align: center; 
                            font-size: 20px; 
                            font-weight: bold; 
                            margin-bottom: 20px; 
                            page-break-before: auto;
                        }
                        .calendar-table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin-bottom: 40px; 
                            table-layout: fixed;
                        }
                        .calendar-table th, .calendar-table td { 
                            border: 1px solid #000; 
                            padding: 8px 4px; 
                            text-align: center; 
                            vertical-align: top; 
                            width: 14.28%;
                            height: 80px;
                            word-wrap: break-word;
                        }
                        .calendar-table th { 
                            background-color: #f0f0f0; 
                            font-weight: bold; 
                            height: 30px;
                        }
                        .date-number { 
                            font-size: 16px; 
                            font-weight: bold; 
                            margin-bottom: 2px; 
                        }
                        .japanese-reading { 
                            font-size: 10px; 
                            color: #666; 
                            margin-bottom: 2px; 
                        }
                        .lunar-date { 
                            font-size: 10px; 
                            color: #8B4513; 
                            margin-bottom: 2px; 
                        }
                        .solar-term { 
                            font-size: 9px; 
                            color: #228B22; 
                            margin-bottom: 2px; 
                        }
                        .holiday-name { 
                            font-size: 10px; 
                            color: #333; 
                            line-height: 1.2; 
                        }
                        .taiwan-holiday .date-number { color: #ff0000; }
                        .japan-holiday .date-number { color: #ff6600; }
                        .weekend .date-number { color: #ff0000; }
                        .other-month { color: #ccc; }
                        .both-holiday .date-number { color: #ff0000; }
                        @page { margin: 2cm; }
                    </style>
                </head>
                <body>
                `;

                currentCalendarData.forEach(monthData => {
                    // 標題（移除HTML標籤並保留完整年號資訊）
                    const cleanTitle = monthData.monthName.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim();
                    docContent += `<div class="month-title">${cleanTitle}</div>`;
                    docContent += `<table class="calendar-table">`;
                    
                    // 星期標題
                    let weekHeaders;
                    if (country.includes('taiwan-en')) {
                        if (country === 'taiwan-en-full') {
                            weekHeaders = weekStart === 0 
                                ? ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']
                                : ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
                        } else if (country === 'taiwan-en-short') {
                            weekHeaders = weekStart === 0 
                                ? ['S', 'M', 'T', 'W', 'T', 'F', 'S']
                                : ['M', 'T', 'W', 'T', 'F', 'S', 'S'];
                        } else { // taiwan-en-abbr
                            weekHeaders = weekStart === 0 
                                ? ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
                                : ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
                        }
                    } else if (country.includes('japan')) {
                        if (country === 'japan-hiragana') {
                            weekHeaders = weekStart === 0 
                                ? ['にちようび', 'げつようび', 'かようび', 'すいようび', 'もくようび', 'きんようび', 'どようび']
                                : ['げつようび', 'かようび', 'すいようび', 'もくようび', 'きんようび', 'どようび', 'にちようび'];
                        } else if (country === 'japan-kanji') {
                            weekHeaders = weekStart === 0 
                                ? ['日曜日', '月曜日', '火曜日', '水曜日', '木曜日', '金曜日', '土曜日']
                                : ['月曜日', '火曜日', '水曜日', '木曜日', '金曜日', '土曜日', '日曜日'];
                        } else { // japan (ruby)
                            weekHeaders = weekStart === 0 
                                ? ['日曜日', '月曜日', '火曜日', '水曜日', '木曜日', '金曜日', '土曜日']
                                : ['月曜日', '火曜日', '水曜日', '木曜日', '金曜日', '土曜日', '日曜日'];
                        }
                    } else {
                        weekHeaders = weekStart === 0 
                            ? ['日', '一', '二', '三', '四', '五', '六']
                            : ['一', '二', '三', '四', '五', '六', '日'];
                    }
                    
                    docContent += '<tr>';
                    weekHeaders.forEach(header => {
                        docContent += `<th>${header}</th>`;
                    });
                    docContent += '</tr>';

                    // 月曆資料
                    const days = monthData.days;
                    for (let i = 0; i < days.length; i += 7) {
                        docContent += '<tr>';
                        for (let j = 0; j < 7; j++) {
                            const day = days[i + j];
                            if (day) {
                                let className = '';
                                if (!day.isCurrentMonth) {
                                    className = 'other-month';
                                } else if (day.holidays.length > 0) {
                                    const hasJapanHoliday = day.holidays.some(h => h.country === 'japan');
                                    const hasTaiwanHoliday = day.holidays.some(h => h.country === 'taiwan');
                                    
                                    if (hasJapanHoliday && hasTaiwanHoliday) {
                                        className = 'both-holiday';
                                    } else if (hasJapanHoliday) {
                                        className = 'japan-holiday';
                                    } else if (hasTaiwanHoliday) {
                                        className = 'taiwan-holiday';
                                    }
                                } else if (day.isWeekend) {
                                    className = 'weekend';
                                }

                                let cellContent = `<div class="${className}">`;
                                cellContent += `<div class="date-number">${day.date}</div>`;
                                
                                // 加入日文讀音（如果是日文模式且為當月日期）
                                if (country.includes('japan') && day.isCurrentMonth && japaneseDays[day.date]) {
                                    cellContent += `<div class="japanese-reading">${japaneseDays[day.date]}</div>`;
                                }
                                
                                // 加入農曆資訊（如果是農曆模式）
                                if (country === 'taiwan-lunar' && day.isCurrentMonth && day.lunarInfo) {
                                    const lunar = day.lunarInfo;
                                    let lunarText = '';
                                    
                                    if (lunar.day === 1) {
                                        lunarText = lunar.isLeapMonth ? 
                                            `閏${lunarMonths[lunar.month - 1]}月` : 
                                            `${lunarMonths[lunar.month - 1]}月`;
                                    } else {
                                        lunarText = lunarDays[lunar.day - 1];
                                    }
                                    
                                    cellContent += `<div class="lunar-date">${lunarText}</div>`;
                                    
                                    if (day.solarTerm) {
                                        cellContent += `<div class="solar-term">${day.solarTerm}</div>`;
                                    }
                                }
                                
                                // 加入假日資訊
                                if (day.holidays.length > 0) {
                                    const holidayText = day.holidays.map(h => h.name.replace(/<[^>]*>/g, '')).join('<br>');
                                    cellContent += `<div class="holiday-name">${holidayText}</div>`;
                                }
                                
                                cellContent += '</div>';
                                docContent += `<td>${cellContent}</td>`;
                            } else {
                                docContent += '<td></td>';
                            }
                        }
                        docContent += '</tr>';
                    }
                    docContent += '</table>';
                });

                docContent += '</body></html>';

                // 建立並下載檔案
                const blob = new Blob([docContent], { type: 'application/msword;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `月曆_${currentCalendarData[0].year}年_${new Date().toISOString().slice(0,10)}.doc`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showMessage('Word 檔案已成功下載', 'success');
            } catch (error) {
                console.error('Word 匯出錯誤:', error);
                showMessage('Word 匯出失敗，請稍後再試', 'error');
            }
        }

        function downloadPDF() {
            if (!currentCalendarData.length) {
                showMessage('請先產生月曆再匯出', 'error');
                return;
            }

            // 使用瀏覽器的列印功能生成PDF
            const originalTitle = document.title;
            document.title = `月曆_${currentCalendarData[0].year}年`;
            
            // 暫時隱藏不需要的元素
            const elementsToHide = ['.controls', '.export-container', '.footer'];
            const hiddenElements = [];
            
            elementsToHide.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                elements.forEach(el => {
                    hiddenElements.push({ element: el, display: el.style.display });
                    el.style.display = 'none';
                });
            });

            // 提示使用者
            setTimeout(() => {
                if (confirm('請在列印對話框中選擇「另存為 PDF」來下載 PDF 檔案。\n\n點擊確定開啟列印對話框，點擊取消返回。')) {
                    window.print();
                }
                
                // 恢復隱藏的元素
                hiddenElements.forEach(({ element, display }) => {
                    element.style.display = display;
                });
                
                document.title = originalTitle;
            }, 100);
        }

        function printCalendar() {
            if (!currentCalendarData.length) {
                showMessage('請先產生月曆再列印', 'error');
                return;
            }

            window.print();
        }

        function shareViaEmail() {
            if (!currentCalendarData.length) {
                showMessage('請先產生月曆再分享', 'error');
                return;
            }

            const year = currentCalendarData[0].year;
            const subject = `台灣日本月曆 - ${year}年`;
            const body = `您好，\n\n我想與您分享這個月曆：\n\n網址：${window.location.href}\n\n這是一個支援台灣和日本節日的線上月曆生成器，包含完整的年號對照功能以及農曆月曆。\n\n謝謝！`;
            
            const mailtoLink = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.location.href = mailtoLink;
        }

        function showMessage(message, type) {
            const existingMessages = document.querySelectorAll('.success-message, .error-message');
            existingMessages.forEach(msg => msg.remove());
            
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
            messageDiv.innerHTML = message;
            
            const container = document.querySelector('.calendar-container');
            container.insertBefore(messageDiv, container.firstChild);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 4000);
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const currentMonth = currentDate.getMonth() + 1; // getMonth() 返回 0-11，需要 +1
            
            document.getElementById('year').value = currentYear;
            document.getElementById('startMonth').value = currentMonth;
        });

        // 動態更新起始月份
        function updateStartMonth() {
            const currentDate = new Date();
            const currentMonth = currentDate.getMonth() + 1;
            document.getElementById('startMonth').value = currentMonth;
        }

        // 每天午夜自動更新（可選功能）
        function scheduleAutoUpdate() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(now.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            
            const timeUntilMidnight = tomorrow.getTime() - now.getTime();
            
            setTimeout(() => {
                updateStartMonth();
                // 重新排程下一次更新
                scheduleAutoUpdate();
            }, timeUntilMidnight);
        }

        // 啟動自動更新排程
        scheduleAutoUpdate();
    </script>
</body>
</html>
